## CHAPTER 5.1 :  DML ⭐️

- DML은 Data Manipulation Language란 의미로 DDL에서 정의한 대로 데이터를 입력하고, 입력된데이터를 수정, 삭제, 조회하는 명령어이다.

### INSERT
- 테이블에 데이터를 입력하는 명령어이다.

```
INSERT INTO 테이블명 (컬럼명1, 컬럼명2 ... ) VALUES( 데이터1, 데이터2 ...);
```

### UPDATE

- 이미 저장된 데이터를 수정하고 싶을 때 사용하는 명령어이다. 수정하고 싶은 컬럼이 많다면 SET절에 
,(콤마) 로 이어서 명시해줄 수 있다. WHERE절이 없으면 테이블의 모든 Row가 변경되니 주의해야 한다.

```
UPDATE 테이블명 SET 컬럼명 = 새로운 데이터 (WHERE 수정할 데이터에 대한 조건)
```


### DELETE

- 이미 저장된 데이터를 삭제하고 싶을 때 사용하는 명령어이다. WHERE 절이 없으면 테이블의 모든 Row가 삭제되니 주의해야 한다.

```
DELETE FROM 테이블명 (WHERE 수정할 데이터에 대한 조건);
```

### MERGE

- 테이블에 새로운 데이터를 입력하거나 이미 저장되어 있는 데이터에 대한 변경 작업을 한 번에 할 수 있도록 해주는 명령어이다.

```
MERGE
	INTO 타겟 테이블명
	USING 비교 테이블명
	ON 조건
	WHEN MATCHED THEN
		UPDATE
			SET 컬럼명 = 새로운 데이터 [, 컬럼명 = 새로운 데이터 --]
	WHEN NOT MATCHED THEN
		INSERT[(컬럼명1, 컬럼명2 )]
		VALUES (데이터1, 데이터2 );
```

---

## CHAPTER 5.2 :  TCL ⭐️⭐️⭐️

### 트랜잭션
- 데이터베이스에서 어떤 작업 혹은 동작들의 최소 실행 단위
- 더 이상 쪼개질 수 없는 작업

### 트랜잭션의 특징

- 원자성 (Atomicity) - 하나의 트랜잭션으로 묶인 일련의 동작들은 모두 성공하거나 모두 실패해야 한다. 즉 살아도 같이 살고 죽어도 같이 죽는 관계가 되는 것이다 (All or Nothing)
- 일관성 (Consistency) - 트랜잭션이 완료된 후에도 데이터베이스가 가진 데이터에 일관성이 있어야 한다. 예를 들어 이미 결제된 티셔츠의 수량과 남아있는 티셔츠 재고의 합은 언제나 쇼핑몰이 처음 보유하고 있었던 티셔츠의 총 수량과 일치해야한다.
- 고립성 (Isolation) - 트랜책션은 고립되어 수행되어야 한다. 만약 내가 구매하고자 하는 티셔츠를 지금 다른 사람이 먼저 구매하고 있다면 나는 재고 데이터를 참조하거나 변경할 수 없고 그 사람의 트랜잭션이 끝날 때 까지 대기해야 한다.
- 영속성 (Durability) - 트랜잭션이 성공적으로 수행되었을 경우 트랜잭션이 변경한 데이터가 영구적으로 저장되어야 함을 의미한다. 쉽게 말해 모든 트랜잭션이 로그에 남겨진 뒤 COMMIT 되어야 하고, 그래서 시스템 장애가 발생하더라도 복구 가능해야 한다는 의미이다.

#### COMMIT
- 커밋 명령어를 만나면 INSERT, UPDATE, DELETE와 같은 DML 명령들을 통한 변경사항을 데이터베이스에 영구적으로 반영하고 락을 해제하여 트랜잭션을 완료한다.

#### ROLLBACK
- 트랜잭션에 포함되는 전체 변경사항(이전의 커밋 명령 이후의 변경사함) 또는 지정된 저장 점 (SAVEPOINT) 이후의 변경사함을 취소하고 원래대로 되돌리며, 커밋과 마찬가지로 락이 해제된다.
- 일단 커밋이 완료된 것에 대해서는 롤백이 불가함에 주의
	(DDL명령어는 자동으로 커밋되어 롤백이 불가하나, DML은 자동커밋이 되지 않아 롤백 가능)

#### SAVEPOINT
- ROLLBACK을 하기위한 저장점을 지정한다. 롤백으로 저장점을 지정하면 트랜잭션에 포함되는 전체 변경 사항이 취소되는 것이 아니라 저장점 이후에 해당하는 변경사항 만 취소된다.

예제
![[스크린샷 2025-03-07 오전 4.59.03.png]]

- COMMIT
	- 커밋이 되면 DB에 적용완료 된다.
- ROLLBACK
	- 직전 COMMIT 이후의 변경사항 (DML)을 취소

> 📌 주의
- SQL 서버의 경우에 BEGIN TRANSACTION을 적어줘야만 롤백이 가능하게 만들어준다.
	- 왜냐하면 SQL 서버의 경우는 자동 COMMIT이 되기 때문이다.
- 만약 위 예시에서 BEGIN TRANSACTION이 없다면 ROLLBACK 불가능
- 오라클의 경우에는 예시에선 모두 롤백 가능

---

## CHAPTER 5.3 :  DDL 

### CREATE

- 테이블을 생성하기 위한 명령어이다.

```
CREATE TABLE 테이블명 (
	컬럼명 1 데이터 타입 (DEFAULT / NULL 여부)
);
```

### ALTER

- 보통 한 번 생성된 테이블의 구조는 변경하지 않는 것이 일반적이지만 시대의 흐름과 업무 요건의 변화로 인해 변경이 불가피한 상황이 생길 수 있다. 이를테면 우편번호가 예전엔 6자리 열지만 현재 5자리로 변경된 경우처럼 말이다.

```
UPDATE 테이블명 SET 컬럼명 = 새로운 데이터 (WHERE 수정할 데이터에 대한 조건)
```

- ADD COLUMN - 새로운 컬럼을 추가할 때
- DROP COLUMN - 기존 컬럼을 삭제할 때
- MODIFY COLUMN - 기존 컬럼을 변경하고 싶을때 
	- 데이터 유형, DEFAULT 값, NOT NULL 제약조건에 대한 변경이 가능하다.
- RENAME COLUMN - 기존에 있던 컬럼의 이름을 변경하고 싶을 떄
- ADD CONSTRAINT - 제약조건을 추가하고 싶을 때 

### DROP TABLE

- 테이블을 삭제할 때 쓰는 명령어이다. 만약 해당 테이블을 참조하고 있는 다른 테이블이 존재하는 경우 CASCADE 옵션을 명시하지 않으면 삭제되지 않는다

	CASCADE CONSTRAINT 는 참조 제약조건도 함께 삭제한다는 의미이다.

```
DROP TABLE 테이블명 [CASCADE CONSTRAINT];
```

### RENAME TABLE

- 테이블 명을 변경할 때 쓰는 명령어이다.

```
RENAME 기존 테이블명 TO 변경할 테이블 명;
```

### TRUNCATE TABLE

- 테이블에 저장되어 있는 데이터를 모두 제거하는 명령어이다. DELETE 명령어와 유사하지만 저장 공간이 재사용되도록 초기화 된다는 차이점이 있고 ROLLBACK이 불가능해 DDL로 분류된다.

```
TRUNCATE TABLE 테이블 명;
```

### 💡 DROP / TRUNCATE / DELETE의 차이

- DROP TABLE 
	- (DDL) 
		- 테이블을 스키마까지 완전하게 삭제
- TRUNCATE TABLE 
	- (DDL) 
		- 테이블을 생성 초기 상태로 초기화 (데이터는 삭제하고 스키마는 남김)
- DELETE FROM TABLE
	- (DML)
		- 스키마는 남겨두고 데이터만 삭제 (WHERE절을 이용하여 특정 행만 삭제 가능)

- DDL는 자동커밋이 된다 하지만 DML은 자동커밋이 되지 않는다 따라서 DELETE는 작업 취소가 가능하다.


---


### 참조 무결성 제약 조건 ⭐️⭐️⭐️

- 데이터의 입력, 수정, 삭제 과정에서 데이터의 일관성 (Consistancy)이 깨지는 것을 DBMS 차원에서 방지하기 위한 조건
- 참조 대상이 되는 쪽이 부모, 참조하는 쪽을 자식이라고 가정

![[스크린샷 2025-03-07 오전 5.29.07.png]]![[스크린샷 2025-03-07 오전 5.30.01.png]]

---

