## 세션 기반 인증

### 세션

세션이란 서버가 저장하는 사이트 방문자들에 대한 기록입니다. 기록엔 id, ip주소, 마지막 방문은 언제인지, 어떤 브라우저를 사용했는지 등의 정보가 담겨 있습니다.

### 세션 기반 인증

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e7d4a5b4-b955-459f-8e67-7b041f0c9f8f/Untitled.png)

세션 기반 인증이란 세션을 활용하는데요. 서버에서 세션 정보를 기록한 뒤에 세션을 식별하는 id를 Set-Cookie로 클라이언트에 응답합니다. 이후 클라이언트가 서버에 요청할 때 서버에서 응답한 쿠키를 자동으로 포함하게 됩니다. 그러면 서버는 클라이언트의 쿠키에 담긴 세션 id만 확인해서 어떤 방문자인지 파악할 수 있습니다.

유저가 로그인하게 되면 서버에서 세션에 유저 id를 저장하면 됩니다. 이후 서버는 요청을 보낸 유저를 특정할 수 있게 됩니다. 이러한 세션은 일정한 기간이 지나거나 클라이언트에서 로그아웃 요청을 보낼 경우, 해당 세션이나 로그인 유저를 만료 처리합니다.

## 토큰 기반 인증

### 인증 토큰

토큰 기반 인증이란 인증 토큰을 사용하는데, 인증 토큰이란 유저에 대한 정보를 암호화한 문자열입니다. 특정 콘텐츠에 접근할 수 있게 해주기 때문에 Access token이라고도 합니다. 토큰의 형식은 JWT(JSON Web Token)형식을 많이 사용합니다.

### 토큰 기반 인증

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0e9ddaa2-e73b-467d-ab49-c1d3038eb5cb/Untitled.png)

토큰 기반 인증은 세션 기반 인증과 달리 유저의 로그인 상태를 저장하고 요청이 올 때마다 저장 및 확인하지 않고도 요청을 보낸 유저를 식별할 수 있습니다. 대신 토큰 자체를 해석해서 사용합니다.

흐름을 살펴보면, 유저가 이메일 비밀번호를 입력해 로그인 요청을 하면 서버는 유효한지 확인합니다. 그 다음 서버는 유저를 식별할 수 있는 id, 만료일 등의 내용을 담은 토큰을 만들어 클라이언트에게 응답합니다. 이때, 응답으로 인증 토큰을 응답의 바디로 넘기기도 하고, Set-Cookie를 하기도 합니다. 이 토큰은 담고싶은 정보와 서버에서만 알고 있는 비밀키를 활용해 만들어진 사람이 식별할 수 없는 문자열입니다. 이후 클라이언트는 응답으로 받은 토큰을 서버에 요청할 때 Authorization 헤더에 담아 보냅니다. 서버는 클라이언트의 토큰을 비밀키를 사용해 다시 해석하고 유효성 검증 및 유저를 특정합니다. 인증 토큰을 사용하면 문자열 토큰을 갖고 있기만 하고 만료시간이 지나지 않았으면 항상 로그인 상태를 유지할 수 있습니다. 로그아웃을 하고 싶으면 클라이언트에서 직접 저장한 토큰을 삭제해주면 됩니다.

## 비교

### 효율성

세션 기반 인증을 사용하면 서버는 항상 로그인 세션 정보를 저장하며, 매 리퀘스트의 유저가 누구인지를 이 정보와 비교를 해야 됩니다. 그리고 이걸 하기 위해서는 용량과 시간이 드는데요. 로그인한 유저가 엄청 많거나 특정 시간에 몰리게 되면 서버의 리퀘스트 처리 속도가 느려질 수도 있습니다.

반면 토큰 기반 인증은 어딘가 저장한 데이터와 비교하는 게 아니라 토큰 자체 내용을 해석하기만 하면 되기 때문에 더 효율적으로 작동할 수 있습니다.

### 유연성

토큰 기반 인증은 세션 기반 인증보다 조금 더 유연하게 사용될 수 있습니다. 토큰을 발행하는 방법이 똑같고, 시크릿 키만 있으면, 발행한 곳과 확인하는 곳이 달라도 된다는 말인데요.

예를 들어 같은 유저 데이터베이스를 사용하는 여러 서비스들이 있고, 이 사이트들이 같은 방식과 키를 사용해서 토큰을 발행한다면, 한 사이트에서 제공한 토큰을 가지고 있으면, 다른 서비스가 그걸 해석해서 유저를 파악할 수 있는 거죠. 요즘은 크고 복잡한 웹 애플리케이션들을 더 작은 내용을 담당하는 작은 부분들로 나눠서 개발하는 경우가 많은데요. 이럴 때 토큰을 사용하는 게 훨씬 더 유연합니다.

### RESTful API

세션 정보와 같이 서버가 "상태" 정보를, 예를 들어 유저가 로그인을 했는지 안 했는지 저장하고 있을 때, stateful 하다고 표현하는데요. REST에 부합하기 위해서는 서버가 상태 정보를 저장하지 않는, stateless 한 특성이 있어야 합니다. 서버는 클라이언트에서 보내는 정보만으로 충분히 상태를 파악할 수 있어야 하죠.

이 기준에서 살펴보면 RESTful한 API 서버를 만들고 있다면 세션 기반 인증보다 토큰 기반 인증이 더 어울립니다.

### 무효화

세션 기반 인증의 장점 중 하나는 바로 서버에서 세션 데이터를 따로 관리하기 때문에 특정 세션을 손쉽게 무효화할 수 있다는 점입니다. 그냥 세션을 관리하는 테이블에 가서 상태를 만료로 바꾸거나 만료일을 지금 당장으로 해버리면 되겠죠? 하지만 토큰 기반 인증을 사용하면 따로 서버가 상태 정보를 저장하지 않기 때문에 특정 토큰을 무효화하는 게 더 복잡합니다. 그리고 이건 꽤 큰 문제들로 이어질 수 있는데요. 예를 들어 금융 서비스에서 누군가 유저 세션을 가로챘는데 이걸 바로 무효화할 수 없다면 저금한 돈을 뺏기는 문제가 생길 수도 있죠. 물론 이중 비밀번호나, OTP라든지 이걸 방지하기 위한 방법들이 있지만, 세션 기반 인증을 사용하면 한 가지 안전장치를 더 쉽게 사용할 수 있습니다.