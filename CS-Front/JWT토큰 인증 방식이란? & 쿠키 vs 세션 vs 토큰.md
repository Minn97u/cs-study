## 인증(Authentication)이란?

## \- 사용자가 누구인지 확인하고, 허용된 자원에 접근할 수 있는지를 검증하는 절차이다.

일반적으로 로그인 과정이 인증 절차에 해당하며, 한 번 인증된 사용자는 이후에도 인증 상태를 유지해야 한다.

이를 위해 다양한 기술들이 사용되는데 쿠키,세션,토큰 방식이 있다.

---

### 🍪 **쿠키 (Cookie)란?**

쿠키는 **브라우저가 서버나 자바스크립트로부터 받아 브라우저 내부에 저장하는 작은 데이터 조각이다.**

-   주로 key=value 형태로 저장되며,
-   HTTP 요청 시 자동으로 서버에 전송된다.

**쿠키의 보안 속성**

| HttpOnly | JS에서 접근 불가 → XSS 방어 |
| --- | --- |
| Secure | HTTPS 환경에서만 전송 |
| SameSite | CSRF 방지 (Strict, Lax, None) 설정 가능 |

---

### **세션 기반 인증이란?**

인증 상태를 서버가 **직접 기억**하는 방식이다.

**💡 동작 흐름**

1.  사용자가 로그인 요청을 하면
2.  서버는 세션을 생성하고, 사용자 정보를 서버 메모리에 저장
3.  서버는 세션 ID를 발급 → **쿠키에 담아 브라우저로 전송**
4.  이후 요청 시 브라우저가 **세션 ID를 쿠키에 담아 자동 전송**
5.  서버는 세션 ID로 사용자 정보 조회 → 인증 완료

**📌 특징**

-   상태 유지를 위해 서버에 **세션 저장소 필요**
-   브라우저는 **세션 ID만 기억**하고, 실제 인증 정보는 서버에 있음
-   인증 처리 속도는 빠르지만, **서버가 상태를 유지**해야 하므로 확장성에 한계가 있음

**✅ 장점**

-   민감한 사용자 정보는 클라이언트에 저장되지 않음 (보안에 유리)
-   세션 강제 만료 등 서버 제어가 쉬움

**❌ 단점**

-   서버가 모든 사용자 상태를 저장해야 하므로 확장성이 어렵다.
-   로드 밸런싱 시 세션 동기화 필요 (→ Redis 세션 저장 등 추가 작업 발생)
-   **CSRF 방어 필요** (세션ID는 쿠키에 저장되므로 자동 전송됨)

---

### **토큰 기반 인증이란?** 

서버가 사용자 상태를 저장하지 않고, 토큰을 통해 인증 정보를 **클라이언트가 들고 다니는 방식이다.**

**💡 동작 흐름 (대표적으로 JWT 사용)**

1.  사용자가 로그인
2.  서버는 사용자 정보를 담은 토큰(JWT)을 생성하여 클라이언트에 전달
3.  클라이언트는 토큰을 **localStorage, sessionStorage, 또는 쿠키에 저장**
4.  이후 요청 시 토큰을 **Authorization 헤더** 또는 쿠키에 담아 서버에 전달
5.  서버는 **토큰을 복호화하여 검증** → 인증 완료

**📌 특징**

-   서버는 **상태를 기억하지 않음 (stateless)**
-   인증 정보는 토큰 자체에 포함됨
-   주로 **JWT(Json Web Token)** 사용

**✅ 장점**

-   서버가 상태를 유지하지 않으므로 **수평 확장(확장성) 용이**
-   다양한 클라이언트(Web, App)에서도 동일한 방식으로 사용 가능

**❌ 단점**

-   토큰이 유출되면 **서버에서 강제 로그아웃이 어려움**
-   클라이언트 저장 방식에 따라 **XSS 또는 CSRF 방지 조치 필요**
-   토큰이 길고 암호화되어 있으므로 **네트워크/클라이언트 부담 있음**

---

**비교표**

| **항목** | **쿠키 (Cookie)** | **세션 (Session)** | **토큰 (Token, JWT)** |
| --- | --- | --- | --- |
| 역할 | **저장소** (브라우저에 저장됨) | **사용자 상태를 서버가 유지** | **인증 정보를 포함한 디지털 증명서** |
| 저장 위치 | 브라우저 (클라이언트) | 서버 메모리 or Redis 등 | 클라이언트 (쿠키, localStorage 등) |
| 누가 관리? | 브라우저 | 서버 | 클라이언트 + 서버 검증 |
| 인증 정보 포함 여부 | ❌ 없음 | ✅ 서버에 저장 | ✅ 토큰 내부에 포함됨 |
| 상태 관리 | Stateless | ✅ Stateful | Stateless |
| 사용 방식 | 단독 사용은 제한적 | 주로 쿠키와 함께 사용 | 주로 쿠키 or 헤더에 실음 |

---

## **JWT (JSON Web Token)란?**

인증 정보를 포함하고 있으며, 위조 방지를 위한 **디지털 서명이 포함된 토큰이다.**

**구조**

```
[Header].[Payload].[Signature]
```

-   Header: 타입과 해싱 알고리즘
-   Payload: 사용자 정보 (sub, exp, iat 등)
-   Signature: 서명값 (서버 비밀키로 생성)

**표준 클레임 예시**

| 클레임 | 설명 |
| --- | --- |
| sub | 사용자 ID |
| exp | 만료 시간 |
| iat | 발급 시간 |
| nbf | 사용 가능 시작 시점 |

JWT는 자체로 인증 정보를 포함하므로 서버는 **토큰 검증만으로 인증 완료**가 가능하다.

---

**JWT 저장 위치: localStorage vs HttpOnly Cookie**

| 항목 | localStorage | HttpOnly 쿠키 |
| --- | --- | --- |
| 저장 위치 | 자바스크립트 | 브라우저 쿠키 |
| XSS 방어 | ❌ (취약) | ✅ (접근 불가) |
| CSRF 방어 | ✅ | ❌ (SameSite 설정 필요) |
| 제어 방식 | 직접 저장/삭제 가능 | 자동 관리, 보안 옵션 필요 |

실무에서는 보안을 위해 HttpOnly + Secure + SameSite 쿠키 조합을 추천한다고 한다.

---

### **Access Token vs Refresh Token**

실무에서는 Access Token의 만료시간을 짧게 두고, Refresh Token으로 재발급하는 구조를 사용한다.

**✍🏻 Access Token이란?**

사용자가 인증되었음을 증명하는 **짧은 유효기간의 JWT**

-   사용자가 로그인하면 서버는 **Access Token을 생성**하여 사용자에게 전달한다.
-   이 토큰은 보통 **사용자의 ID, 권한, 만료 시간 (exp) 등**을 포함하고 있고
-   이후 클라이언트는 요청마다 이 토큰을 Authorization 헤더에 담아 전송하게 된다.

**특징**

-   유효기간이 짧음 (예: 15분 ~ 1시간)
-   **만료되면 재발급이 필요**
-   탈취되면 위험하므로 HttpOnly 쿠키나 Authorization 헤더로 안전하게 전달해야 함

**✍🏻 Refresh Token이란?**

Access Token이 만료되었을 때 **새로운 Access Token을 발급받기 위한 수단**

-   Access Token은 보안상 짧게 유지되므로, **사용자가 계속 로그인된 상태를 유지하기 위해 필요**
-   Refresh Token은 **보통 클라이언트가 아닌 서버 또는 쿠키에 저장**
-   Refresh Token을 서버에 보내면, 서버는 검증 후 **새로운 Access Token을 발급**해준다.

**특징**

-   유효기간이 길다 (예: 1주 ~ 1개월)
-   탈취 시 위험이 크기 때문에 반드시 **서버 저장 또는 HttpOnly 쿠키로 보관**
-   보통 DB 또는 Redis에 **리프레시 토큰 목록을 저장해 유효성 검증**

**정리**

| **항목** | **Access Token** | **Refresh Token** |
| --- | --- | --- |
| 유효기간 | 짧음 (15~30분) | 김 (1주~1달) |
| 저장 위치 | 쿠키 or localStorage | HttpOnly 쿠키 or 서버 DB |
| 탈취 시 영향 | 인증 허용됨 (제한적 피해) | 무제한 재발급 → 더 위험 |
| 보호 방법 | 짧은 TTL, HttpOnly, SameSite | DB 보관, 서명 검증, IP 확인 등 |

---

#### **언제 세션을, 언제 토큰을 쓸까?**

| **상황** | **추천 방식** |
| --- | --- |
| 전통적인 서버 렌더링 웹사이트 | 세션 기반 인증 |
| SPA, 모바일 앱, API 서버 | JWT 기반 토큰 인증 |
| 높은 보안 요구 (은행, 사내망) | 세션 기반 + HTTPS + 쿠키 제한 강화 |